# =============================================================================
# v0 Strategy Engine Pro - Backtesting & Demo Trading Configuration
# =============================================================================
# This file contains configurations for:
# 1. DEMO TRADING: Test trade signals and profitability WITHOUT RISKING REAL FUNDS
# 2. BACKTESTING: Test strategies against HISTORICAL DATA before launching live trading
#
# Copy relevant sections to your main .env file

# =============================================================================
# TRADING MODE SELECTION
# =============================================================================

# Available trading modes:
# - manual: User-initiated trades only (via Telegram or web dashboard)
# - semi_auto: Signal alerts with manual confirmation required
# - auto: Fully automated trading based on signals
# - paper_trading/demo: Test signals in REAL-TIME without risking funds (simulated trading)
# - backtest: Test strategies against HISTORICAL DATA before going live
TRADING_MODE=demo

# =============================================================================
# DEMO TRADING MODE (Test Signals Without Risking Funds)
# =============================================================================
# Purpose: Validate trade signals and profitability in real-time with virtual funds
# Use case: Test your trading signals before risking real capital

# Enable demo mode (alias for paper_trading)
ENABLE_DEMO_MODE=true

# --- Virtual Capital ---
# Initial balance for demo trading (USD) - NO REAL MONEY RISKED
DEMO_INITIAL_BALANCE=10000

# Reset balance daily (useful for testing new signals each day)
DEMO_RESET_DAILY=false

# Reset balance weekly (for weekly strategy testing)
DEMO_RESET_WEEKLY=false

# --- Realistic Trading Simulation ---
# Maker fee (limit orders) - simulates real exchange fees
DEMO_MAKER_FEE=0.001  # 0.1%

# Taker fee (market orders) - simulates real exchange fees
DEMO_TAKER_FEE=0.002  # 0.2%

# Slippage simulation - simulates real market slippage
DEMO_SLIPPAGE=0.001  # 0.1%

# Slippage model
# - fixed: Fixed percentage (simple)
# - volume_based: Based on order size vs market volume (realistic)
# - volatility_based: Based on market volatility (advanced)
DEMO_SLIPPAGE_MODEL=fixed

# --- Order Execution Simulation ---
# Simulate partial fills (realistic order execution)
DEMO_PARTIAL_FILLS=true

# Simulate order rejections (test edge cases)
DEMO_SIMULATE_REJECTIONS=true

# Rejection probability (e.g., 0.01 = 1% orders rejected)
DEMO_REJECTION_PROBABILITY=0.01

# Simulate exchange latency (milliseconds)
DEMO_LATENCY=100

# --- Performance Tracking ---
# Track performance metrics (win rate, profit factor, etc.)
DEMO_TRACK_PERFORMANCE=true

# Save demo trading history for analysis
DEMO_SAVE_HISTORY=true

# Demo trading output directory
DEMO_OUTPUT_DIR=./demo_results

# Generate daily performance reports
DEMO_DAILY_REPORTS=true

# Send notifications via Telegram (for demo trades)
DEMO_NOTIFICATIONS_ENABLED=true

# --- Risk Management in Demo Mode ---
# Test risk management rules without real capital
DEMO_MAX_POSITION_SIZE=2500  # Max $2500 per position (25% of $10k)
DEMO_MAX_DAILY_LOSS=500  # Stop if lose $500 in a day
DEMO_STOP_LOSS_PERCENTAGE=2.0  # 2% stop loss
DEMO_TAKE_PROFIT_PERCENTAGE=5.0  # 5% take profit

# =============================================================================
# PAPER TRADING MODE (Identical to Demo Mode)
# =============================================================================
# PAPER_TRADING is an alias for DEMO_MODE
# Use whichever terminology you prefer

ENABLE_PAPER_TRADING=true
PAPER_TRADING_INITIAL_BALANCE=10000
PAPER_TRADING_MAKER_FEE=0.001
PAPER_TRADING_TAKER_FEE=0.002
PAPER_TRADING_SLIPPAGE=0.001

# =============================================================================
# BACKTESTING MODE (Test Strategies Against Historical Data)
# =============================================================================
# Purpose: Validate trading strategies BEFORE launching live trading sessions
# Use case: Test your strategy on past data to see if it would have been profitable

# Enable backtesting mode
ENABLE_BACKTESTING=true

# --- Historical Data Range ---
# Start date for backtesting (YYYY-MM-DD format)
# Test your strategy from this date onwards
BACKTEST_START_DATE=2023-01-01

# End date for backtesting (YYYY-MM-DD format)
# Test your strategy up to this date
BACKTEST_END_DATE=2024-12-31

# --- Initial Capital for Backtesting ---
# Starting capital for historical test (USD)
BACKTEST_INITIAL_CAPITAL=10000

# --- Trading Costs (Historical Simulation) ---
# Commission per trade (e.g., 0.001 = 0.1%)
BACKTEST_COMMISSION=0.001

# Maker fee (for limit orders in backtest)
BACKTEST_MAKER_FEE=0.001

# Taker fee (for market orders in backtest)
BACKTEST_TAKER_FEE=0.002

# Slippage per trade (simulates real market conditions)
BACKTEST_SLIPPAGE=0.001

# --- Timeframe Configuration ---
# Candle timeframe for backtesting
# Options: 1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M
BACKTEST_TIMEFRAME=1h

# Secondary timeframe for multi-timeframe strategies (optional)
BACKTEST_SECONDARY_TIMEFRAME=4h

# --- Symbol Configuration ---
# Crypto pairs to backtest (comma-separated, no spaces)
BACKTEST_SYMBOLS=BTC/USDT,ETH/USDT,ADA/USDT,DOT/USDT,LINK/USDT,SOL/USDT,MATIC/USDT

# How to select symbols
# - fixed: Use BACKTEST_SYMBOLS list above
# - dynamic: Auto-select top N symbols by trading volume
# - custom: Load from external file
BACKTEST_SYMBOL_SELECTION=fixed

# Number of symbols for dynamic selection
BACKTEST_DYNAMIC_SYMBOL_COUNT=10

# =============================================================================
# STRATEGY OPTIMIZATION (Find Best Parameters)
# =============================================================================
# Purpose: Automatically find the best strategy parameters for profitability

# Enable strategy parameter optimization
BACKTEST_OPTIMIZE=true

# What to optimize for:
# - total_return: Maximize total profit
# - sharpe_ratio: Best risk-adjusted return (RECOMMENDED)
# - sortino_ratio: Downside risk-adjusted return
# - calmar_ratio: Return vs max drawdown
# - max_drawdown: Minimize maximum loss (use negative value)
# - win_rate: Maximize percentage of winning trades
# - profit_factor: Gross profit / gross loss ratio
BACKTEST_OPTIMIZATION_METRIC=sharpe_ratio

# Optimization algorithm
# - grid: Test all parameter combinations (slow but thorough)
# - random: Random parameter sampling (faster)
# - genetic: Genetic algorithm (smart search)
# - bayesian: Bayesian optimization (most efficient)
BACKTEST_OPTIMIZATION_METHOD=genetic

# Number of optimization iterations
BACKTEST_OPTIMIZATION_ITERATIONS=100

# --- Walk-Forward Optimization (Prevent Overfitting) ---
# Test strategy on out-of-sample data to avoid curve-fitting
BACKTEST_WALK_FORWARD=true

# Training period (days) - optimize parameters on this period
BACKTEST_WALK_FORWARD_TRAIN=180

# Testing period (days) - validate parameters on this period
BACKTEST_WALK_FORWARD_TEST=90

# Number of walk-forward windows to test
BACKTEST_WALK_FORWARD_WINDOWS=4

# Anchored walk-forward (true) or rolling window (false)
BACKTEST_WALK_FORWARD_ANCHORED=false

# --- Strategy Parameters to Optimize ---
# Example parameters (customize for your strategy)

# Moving average periods
BACKTEST_PARAM_MA_FAST_MIN=5
BACKTEST_PARAM_MA_FAST_MAX=20
BACKTEST_PARAM_MA_FAST_STEP=5

BACKTEST_PARAM_MA_SLOW_MIN=20
BACKTEST_PARAM_MA_SLOW_MAX=100
BACKTEST_PARAM_MA_SLOW_STEP=10

# RSI parameters
BACKTEST_PARAM_RSI_PERIOD_MIN=7
BACKTEST_PARAM_RSI_PERIOD_MAX=21
BACKTEST_PARAM_RSI_PERIOD_STEP=7

BACKTEST_PARAM_RSI_OVERSOLD_MIN=20
BACKTEST_PARAM_RSI_OVERSOLD_MAX=40
BACKTEST_PARAM_RSI_OVERSOLD_STEP=5

BACKTEST_PARAM_RSI_OVERBOUGHT_MIN=60
BACKTEST_PARAM_RSI_OVERBOUGHT_MAX=80
BACKTEST_PARAM_RSI_OVERBOUGHT_STEP=5

# Stop loss and take profit
BACKTEST_PARAM_STOP_LOSS_MIN=0.01
BACKTEST_PARAM_STOP_LOSS_MAX=0.05
BACKTEST_PARAM_STOP_LOSS_STEP=0.005

BACKTEST_PARAM_TAKE_PROFIT_MIN=0.02
BACKTEST_PARAM_TAKE_PROFIT_MAX=0.10
BACKTEST_PARAM_TAKE_PROFIT_STEP=0.01

# =============================================================================
# PERFORMANCE METRICS TRACKING
# =============================================================================
# Metrics to calculate and track (comma-separated)
BACKTEST_TRACK_METRICS=total_return,annual_return,sharpe_ratio,sortino_ratio,calmar_ratio,max_drawdown,avg_drawdown,win_rate,loss_rate,profit_factor,avg_win,avg_loss,largest_win,largest_loss,avg_trade_duration,total_trades,winning_trades,losing_trades

# Risk metrics
BACKTEST_RISK_FREE_RATE=0.02  # Risk-free rate for Sharpe/Sortino (2% annual)
BACKTEST_CALCULATE_VAR=true   # Value at Risk
BACKTEST_VAR_CONFIDENCE=0.95   # 95% confidence level
BACKTEST_CALCULATE_CVAR=true  # Conditional VaR (expected shortfall)

# =============================================================================
# OUTPUT SETTINGS
# =============================================================================

# Save individual trade records (CSV file)
BACKTEST_SAVE_TRADES=true

# Save equity curve data (chart of portfolio value over time)
BACKTEST_SAVE_EQUITY_CURVE=true

# Save performance metrics summary
BACKTEST_SAVE_METRICS=true

# Generate HTML report with charts and statistics
BACKTEST_GENERATE_REPORT=true

# Generate charts (equity curve, drawdown, returns, etc.)
BACKTEST_GENERATE_CHARTS=true

# Output directory for backtest results
BACKTEST_OUTPUT_DIR=./backtest_results

# Output format for data files
# Options: csv, json, parquet, excel
BACKTEST_OUTPUT_FORMAT=csv

# Compress output files (saves disk space)
BACKTEST_COMPRESS_OUTPUT=false

# =============================================================================
# ADVANCED BACKTESTING OPTIONS
# =============================================================================

# --- Position Sizing ---
# How to calculate position size
# - fixed: Fixed dollar amount per trade
# - percent: Percentage of current capital
# - kelly: Kelly criterion (optimal bet sizing)
# - optimal_f: Optimal fixed fraction
BACKTEST_POSITION_SIZING=percent

# Position size (meaning depends on sizing method)
BACKTEST_POSITION_SIZE=0.10  # 10% of capital per trade

# Maximum position size (safety limit)
BACKTEST_MAX_POSITION_SIZE=0.25  # Never use more than 25% on one trade

# --- Risk Management Rules ---
# Maximum number of concurrent open positions
BACKTEST_MAX_POSITIONS=5

# Maximum daily loss (stop trading if hit)
BACKTEST_MAX_DAILY_LOSS=0.05  # 5% of capital

# Maximum total drawdown (stop if portfolio drops this much)
BACKTEST_MAX_DRAWDOWN=0.20  # 20% drawdown limit

# --- Order Execution Model ---
# How to simulate order fills
# - immediate: Fill at current candle close price (unrealistic)
# - next_bar: Fill at next candle open (more realistic)
# - realistic: Simulate order book depth (requires tick data)
BACKTEST_FILL_MODEL=next_bar

# Limit order fill probability (some limit orders don't fill)
BACKTEST_LIMIT_FILL_PROBABILITY=0.95

# --- Market Conditions ---
# Respect trading hours (crypto trades 24/7, stocks don't)
BACKTEST_RESPECT_TRADING_HOURS=false

# Include weekend data
BACKTEST_INCLUDE_WEEKENDS=true

# Include holiday data
BACKTEST_INCLUDE_HOLIDAYS=true

# --- Data Quality ---
# How to handle missing candles
# - skip: Skip periods with missing data
# - forward_fill: Use previous value
# - interpolate: Estimate missing values
BACKTEST_MISSING_DATA_HANDLING=forward_fill

# Minimum data quality threshold (reject poor quality data)
BACKTEST_MIN_DATA_QUALITY=0.95  # 95% data must be present

# =============================================================================
# MONTE CARLO SIMULATION (Test Strategy Robustness)
# =============================================================================
# Purpose: Test how strategy performs under different random scenarios

# Enable Monte Carlo simulation
BACKTEST_MONTE_CARLO_ENABLED=false

# Number of Monte Carlo simulation runs
BACKTEST_MONTE_CARLO_RUNS=1000

# Randomization method
# - bootstrap: Resample actual trade results
# - parametric: Assume normal distribution of returns
BACKTEST_MONTE_CARLO_METHOD=bootstrap

# Confidence interval for results
BACKTEST_MONTE_CARLO_CONFIDENCE=0.95  # 95% confidence

# =============================================================================
# BENCHMARK COMPARISON
# =============================================================================
# Compare your strategy against buy-and-hold

# Enable benchmark comparison
BACKTEST_BENCHMARK_ENABLED=true

# Benchmark symbol (e.g., BTC/USDT for crypto)
BACKTEST_BENCHMARK_SYMBOL=BTC/USDT

# Compare against simple buy-and-hold strategy
BACKTEST_BENCHMARK_BUY_HOLD=true

# =============================================================================
# REPORTING & VISUALIZATION
# =============================================================================

# Report detail level
# - minimal: Basic metrics only
# - standard: Standard performance report
# - comprehensive: Detailed analysis with charts
BACKTEST_REPORT_TEMPLATE=comprehensive

# Charts to generate (comma-separated)
BACKTEST_CHARTS=equity_curve,drawdown,monthly_returns,returns_distribution,cumulative_returns

# Chart resolution (DPI - higher = better quality)
BACKTEST_CHART_DPI=300

# Chart file format
# Options: png, svg, pdf
BACKTEST_CHART_FORMAT=png

# =============================================================================
# NOTIFICATIONS & ALERTS
# =============================================================================

# Send Telegram notification when backtest completes
BACKTEST_NOTIFY_ON_COMPLETE=true

# Send notification if backtest errors occur
BACKTEST_NOTIFY_ON_ERROR=true

# Email backtest report after completion
BACKTEST_EMAIL_REPORT=false

# =============================================================================
# PARALLEL PROCESSING (Speed Up Backtests)
# =============================================================================

# Enable parallel processing for faster backtests
BACKTEST_PARALLEL_ENABLED=true

# Number of CPU cores to use (0 = auto-detect)
BACKTEST_PARALLEL_WORKERS=0

# Chunk size for parallel processing
BACKTEST_PARALLEL_CHUNK_SIZE=100

# =============================================================================
# LOGGING
# =============================================================================

# Backtest log level
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
BACKTEST_LOG_LEVEL=INFO

# Save backtest logs to file
BACKTEST_SAVE_LOGS=true

# Backtest log file location
BACKTEST_LOG_FILE=./logs/backtest.log

# Log every N trades (prevents excessive logging)
BACKTEST_LOG_EVERY_N_TRADES=10